<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `message_builder` mod in crate `domain`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, message_builder">

    <title>domain::bits::message_builder - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../../normalize.css">
    <link rel="stylesheet" type="text/css" href="../../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../../main.css">
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'><a href='../../index.html'>domain</a>::<wbr><a href='../index.html'>bits</a></p><script>window.sidebarCurrent = {name: 'message_builder', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Module <a href='../../index.html'>domain</a>::<wbr><a href='../index.html'>bits</a>::<wbr><a class="mod" href=''>message_builder</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../../../src/domain/bits/message_builder.rs.html#1-554' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Building a new message.</p>

<p>DNS messages consist of five sections. The first, the <em>header section</em>
contain, among other things, the number of entries in the following four
section which then contain these entries without any further
delimitation. In order to safely build a correct message, it thus needs
to be assembled step by step, entry by entry. This module provides four
types, each responsible for assembling one of the entry sections.</p>

<p>You start out with a <a href="struct.MessageBuilder.html"><code>MessageBuilder</code></a> which you can either create from
an existing <a href="../compose/Composer.html"><code>Composer</code></a> or, as a shortcut, either completely <a href="struct.MessageBuilder.html#method.new"><code>new()</code></a>
or from an existing bytes vector via <a href="struct.MessageBuilder.html#method.from_vec"><code>from_vec()</code></a>. Like all of these
type, the <a href="struct.MessageBuilder.html"><code>MessageBuilder</code></a> allows access to the header section. In
addition, it is used for building the <em>question section</em> of the message.
This section contains <a href="../question/struct.Question.html"><code>Question</code></a>s to be asked of a name server,
normally exactly one. You can add questions using the
<a href="struct.MessageBuilder.html#method.push"><code>push()</code></a> method.</p>

<p>Once you are happy with the question section, you can proceed to the
next section, the <em>answer section,</em> by calling the
<a href="struct.MessageBuilder.html#method.answer"><code>answer()</code></a> method. In a
response, this section contains those resource records that answer the
question. The section is represented by the <a href="struct.AnswerBuilder.html"><code>AnswerBuilder</code></a> type.
It, too, has a <a href="struct.AnswerBuilder.html#method.push"><code>push()</code></a> method,
but for <a href="../record/struct.Record.html"><code>Record</code></a>s.</p>

<p>A call to <a href="struct.AnswerBuilder.html#method.authority"><code>authority()</code></a>
moves on to the <em>authority section</em>. It contains resource records that
point to the name servers that serve authoritative for the question.
Like with the answer section,
<a href="struct.AuthorityBuilder.html#method.push"><code>push()</code></a> adds records to this
section.</p>

<p>The final section is the <em>additional section.</em> Here a name server can add
information it believes will help the client to get to the answer it
really wants. Which these are depends on the question and is generally
given in RFCs that define the record types. Unsurprisingly, you will
arrive at a <a href="struct.AdditionalBuilder.html"><code>AdditionalBuilder</code></a> by calling the
<a href="struct.AuthorityBuilder.html#method.additional"><code>additional()</code></a> method
once you are done with the authority section.</p>

<p>Once you are done with the additional section, too, you call
<a href="struct.AdditionalBuilder.html#method.finish"><code>finish()</code></a> to retrieve
the bytes vector with the assembled message data.</p>

<p>Since at least some of the sections are empty in many messages, for
instance, a simple request only contains a single question, there are
shortcuts in place to skip over sections. Each type can go to any later
section through the methods named above. Each type also has a <code>finish()</code>
method to arrive at the final data quickly.</p>

<h1 id='example' class='section-header'><a href='#example'>Example</a></h1>
<p>To summarize all of this, here is an example that builds a
response to an A query for example.com that contains two A records and
nothing else.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">str</span>::<span class="ident">FromStr</span>;
<span class="kw">use</span> <span class="ident">domain</span>::<span class="ident">bits</span>::{<span class="ident">ComposeMode</span>, <span class="ident">DNameBuf</span>, <span class="ident">MessageBuilder</span>, <span class="ident">Question</span>};
<span class="kw">use</span> <span class="ident">domain</span>::<span class="ident">iana</span>::<span class="ident">Rtype</span>;
<span class="kw">use</span> <span class="ident">domain</span>::<span class="ident">rdata</span>::<span class="ident">A</span>;

<span class="kw">let</span> <span class="ident">name</span> <span class="op">=</span> <span class="ident">DNameBuf</span>::<span class="ident">from_str</span>(<span class="string">&quot;example.com.&quot;</span>).<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">msg</span> <span class="op">=</span> <span class="ident">MessageBuilder</span>::<span class="ident">new</span>(<span class="ident">ComposeMode</span>::<span class="ident">Limited</span>(<span class="number">512</span>),
                                  <span class="bool-val">true</span>).<span class="ident">unwrap</span>();
<span class="ident">msg</span>.<span class="ident">header_mut</span>().<span class="ident">set_rd</span>(<span class="bool-val">true</span>);
<span class="ident">msg</span>.<span class="ident">push</span>((<span class="kw-2">&amp;</span><span class="ident">name</span>, <span class="ident">Rtype</span>::<span class="ident">A</span>));
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">msg</span> <span class="op">=</span> <span class="ident">msg</span>.<span class="ident">answer</span>();
<span class="ident">msg</span>.<span class="ident">push</span>((<span class="kw-2">&amp;</span><span class="ident">name</span>, <span class="number">86400</span>, <span class="ident">A</span>::<span class="ident">from_octets</span>(<span class="number">192</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>))).<span class="ident">unwrap</span>();
<span class="ident">msg</span>.<span class="ident">push</span>((<span class="kw-2">&amp;</span><span class="ident">name</span>, <span class="number">86400</span>, <span class="ident">A</span>::<span class="ident">from_octets</span>(<span class="number">192</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>))).<span class="ident">unwrap</span>();
<span class="kw">let</span> _ <span class="op">=</span> <span class="ident">msg</span>.<span class="ident">finish</span>(); <span class="comment">// get the Vec&lt;u8&gt;</span></pre>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.AdditionalBuilder.html"
                                  title='struct domain::bits::message_builder::AdditionalBuilder'>AdditionalBuilder</a></td>
                           <td class='docblock-short'>
                                <p>A type for building the additional section of a DNS message.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.AnswerBuilder.html"
                                  title='struct domain::bits::message_builder::AnswerBuilder'>AnswerBuilder</a></td>
                           <td class='docblock-short'>
                                <p>A type for building the answer section of a DNS message.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.AuthorityBuilder.html"
                                  title='struct domain::bits::message_builder::AuthorityBuilder'>AuthorityBuilder</a></td>
                           <td class='docblock-short'>
                                <p>A type for building the authority section of a DNS message.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.MessageBuilder.html"
                                  title='struct domain::bits::message_builder::MessageBuilder'>MessageBuilder</a></td>
                           <td class='docblock-short'>
                                <p>A type for building the question section of a DNS message.</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../../";
        window.currentCrate = "domain";
    </script>
    <script src="../../../jquery.js"></script>
    <script src="../../../main.js"></script>
    <script defer src="../../../search-index.js"></script>
</body>
</html>